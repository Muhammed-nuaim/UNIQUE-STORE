<%- include('../layouts/admin/header.ejs') %>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<div class="container py-5">
    <h1 class="mb-4 text-center">Offer Management</h1>
    
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link" href="/admin/productOffer">Product Offers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="/admin/categoryOffer">Category Offers</a>
        </li>
    </ul>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title mb-4">Add New Offer</h5>
            <form>
                <!-- Updated product selection with better styling -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Select Products</label>
                    <div class="product-selection-wrapper">
                        <div class="input-group mb-2">
                            <span class="input-group-text border-secondary bg-light">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" id="productSearch" class="form-control border-secondary" 
                                   placeholder="Search products" 
                                   onclick="toggleProductList(true)">
                            <button type="button" class="btn btn-dark" onclick="toggleProductList()">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <!-- Improved dropdown styling -->
                        <div id="productListDropdown" class="product-list-dropdown">
                            <div class="select-all-option">
                                <label class="d-flex align-items-center p-3 border-bottom border-secondary">
                                    <input type="checkbox" id="selectAll" class="form-check-input me-2">
                                    <span class="fw-bold">Select All Products</span>
                                </label>
                            </div>
                            <div id="productList" class="product-list">
                                <!-- Products will be listed here -->
                            </div>
                        </div>

                        <!-- Improved selected products display -->
                        <div id="selectedProductsContainer" class="mt-3">
                            <div class="selected-products-header d-flex justify-content-between align-items-center p-3 bg-secondary text-white rounded-top">
                                <span class="fw-bold">Selected Products</span>
                                <span id="selectedCount" class="badge bg-light text-dark">0</span>
                            </div>
                            <div id="selectedProductsList" class="selected-products-list">
                                <!-- Selected products will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rest of the form with improved styling -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Offer Name</label>
                        <input type="text" id="name" class="form-control border-secondary" placeholder="Enter offer name">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Offer Type</label>
                        <select class="form-select border-secondary">
                            <option selected>Select offer type</option>
                            <option>Percentage</option>
                            <option>Fixed Amount</option>
                        </select>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Offer Value</label>
                        <input type="text" id="value" class="form-control border-secondary" placeholder="Enter value">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Expiry Date</label>
                        <input type="date" id="date" class="form-control border-secondary">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success w-100">
                    <i class="fas fa-plus-circle me-2"></i> Add Offer
                </button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title mb-4">Product Offers</h5>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>NAME</th>
                            <th>TYPE</th>
                            <th>APPLIED PRODUCT</th>
                            <th>VALUE</th>
                            <th>START DATE</th>
                            <th>END DATE</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>I16OFF10</td>
                            <td>Percentage</td>
                            <td>Apple iPhone 16</td>
                            <td>10%</td>
                            <td>01/01/2024</td>
                            <td>11/06/2024</td>
                            <td>
                                <button class="btn btn-danger btn-sm">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>SUMMERSAL20</td>
                            <td>Fixed Amount</td>
                            <td>Summer Collection</td>
                            <td>$20</td>
                            <td>15/05/2024</td>
                            <td>15/08/2024</td>
                            <td>
                                <button class="btn btn-danger btn-sm">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
/* Updated styling */
.product-selection-wrapper {
    position: relative;
}

.product-list-dropdown {
    position: absolute;
    top: 100%;
    right: 0;  /* Changed from left: 0 to right: 0 */
    width: 300px; /* Fixed width for dropdown */
    background: white;
    border: 2px solid #adb5bd;  /* Darker border */
    border-radius: 8px;
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
    box-shadow: 0 4px 12px rgba(58, 52, 52, 0.642);
    margin-top: 5px;
}

.product-list {
    max-height: 350px;
    overflow-y: auto;
}

.product-item {
    padding: 12px 16px;
    border-bottom: 1px solid #adb5bd;
    display: flex;
    align-items: center;
    transition: all 0.2s ease;
}

.product-item:hover {
    background-color: #f8f9fa;
}

.product-item:last-child {
    border-bottom: none;
}

.product-item label {
    margin-bottom: 0;
    cursor: pointer;
    flex-grow: 1;
    display: flex;
    align-items: center;
    font-weight: 500;
}

.product-item input[type="checkbox"] {
    margin-right: 12px;
    width: 18px;
    height: 18px;
    border: 2px solid #adb5bd;
}

.selected-products-list {
    border: 2px solid #adb5bd;
    border-top: none;
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
    max-height: 200px;
    overflow-y: auto;
}

.selected-product {
    padding: 12px 16px;
    border-bottom: 1px solid #adb5bd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #fff;
    transition: all 0.2s ease;
}

.selected-product:hover {
    background-color: #f8f9fa;
}

.selected-product:last-child {
    border-bottom: none;
}

.remove-product {
    color: #dc3545;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.remove-product:hover {
    background-color: #dc3545;
    color: white;
}

.select-all-option {
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
    border-bottom: 1px solid #adb5bd;
}

.select-all-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
    border: 2px solid #adb5bd;
}

/* Show dropdown when active */
.product-list-dropdown.show {
    display: block;
}

/* Custom scrollbar */
.product-list::-webkit-scrollbar,
.selected-products-list::-webkit-scrollbar {
    width: 8px;
}

.product-list::-webkit-scrollbar-track,
.selected-products-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.product-list::-webkit-scrollbar-thumb,
.selected-products-list::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

.product-list::-webkit-scrollbar-thumb:hover,
.selected-products-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Form control focus states */
.form-control:focus,
.form-select:focus {
    border-color: #adb5bd;
    box-shadow: 0 0 0 0.2rem rgba(33, 37, 41, 0.25);
}

/* Button hover states */
.btn-dark:hover {
    background-color: #adb5bd;
    border-color: #adb5bd;
}
</style>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample products - replace with your actual product data
    const products = [
        { id: 1, name: "iPhone 16", price: "$999" },
        { id: 2, name: "Samsung S24", price: "$899" },
        { id: 3, name: "MacBook Pro", price: "$1299" },
        { id: 4, name: "iPad Pro", price: "$799" },
        { id: 5, name: "AirPods Pro", price: "$249" },
        { id: 6, name: "Galaxy Watch", price: "$399" },
        { id: 7, name: "Dell XPS", price: "$1499" },
        { id: 8, name: "Surface Pro", price: "$999" },
        { id: 9, name: "Google Pixel", price: "$699" },
        { id: 10, name: "OnePlus 12", price: "$899" }
    ];

    let selectedProducts = new Set();
    const productListDropdown = document.getElementById('productListDropdown');
    const productList = document.getElementById('productList');
    const selectedProductsList = document.getElementById('selectedProductsList');
    const productSearch = document.getElementById('productSearch');
    const selectAll = document.getElementById('selectAll');
    const selectedCount = document.getElementById('selectedCount');

    // Initialize the product list
    function renderProducts(filterText = '') {
        const filtered = products.filter(product => 
            product.name.toLowerCase().includes(filterText.toLowerCase())
        );
        
        productList.innerHTML = filtered.map(product => `
            <div class="product-item">
                <label>
                    <input type="checkbox" 
                           class="form-check-input" 
                           value="${product.id}" 
                           ${selectedProducts.has(product.id) ? 'checked' : ''}>
                    ${product.name} - ${product.price}
                </label>
            </div>
        `).join('');
    }

    // Render selected products
    function renderSelectedProducts() {
        selectedProductsList.innerHTML = Array.from(selectedProducts)
            .map(id => {
                const product = products.find(p => p.id === id);
                return `
                    <div class="selected-product">
                        <span>${product.name} - ${product.price}</span>
                        <i class="fas fa-times remove-product" data-id="${product.id}"></i>
                    </div>
                `;
            })
            .join('');
        selectedCount.textContent = selectedProducts.size;
    }

    // Toggle dropdown visibility
    window.toggleProductList = function(show = null) {
        if (show === null) {
            productListDropdown.classList.toggle('show');
        } else {
            productListDropdown.classList.toggle('show', show);
        }
    }

    // Search functionality
    productSearch.addEventListener('input', (e) => {
        renderProducts(e.target.value);
    });

    // Handle product selection
    productList.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
            const productId = Number(e.target.value);
            if (e.target.checked) {
                selectedProducts.add(productId);
            } else {
                selectedProducts.delete(productId);
            }
            renderSelectedProducts();
        }
    });

    // Handle select all
    selectAll.addEventListener('change', (e) => {
        if (e.target.checked) {
            products.forEach(product => selectedProducts.add(product.id));
        } else {
            selectedProducts.clear();
        }
        renderProducts(productSearch.value);
        renderSelectedProducts();
    });

    // Handle remove selected product
    selectedProductsList.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-product')) {
            const productId = Number(e.target.dataset.id);
            selectedProducts.delete(productId);
            renderProducts(productSearch.value);
            renderSelectedProducts();
        }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.product-selection-wrapper')) {
            toggleProductList(false);
        }
    });

    // Initial render
    renderProducts();
    renderSelectedProducts();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<%- include('../layouts/admin/footer.ejs') %>